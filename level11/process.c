#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void decrypt(char *buffer, int length)
{
  char oldbuffer;
  unsigned int key;
  int i;

  key = length & 0xff;

  for(i = 0; i < length; i++) {
      oldbuffer = buffer[i];
      buffer[i] ^= key;
      key -= oldbuffer;
  }
}

void encrypt(char *buffer, int length)
{
  unsigned int key;
  int i;

  key = length & 0xff;

  for(i = 0; i < length; i++) {
      buffer[i] ^= key;
      key -= buffer[i];
  }
}

int main(int argc, char **argv)
{
  char *buffer;
  int i, length;

  if (argc == 1) {
      printf("Need a string to process\n");
      exit(1);
  }

  length = strlen(argv[1]);
  buffer = (char*) malloc(length);
  strncpy(buffer, argv[1], length);

  printf("Encrypted bytes:\n");
  encrypt(buffer, length);
  for(i = 0; i < length; i++) {
    printf("%u", buffer[i]);
    if (i == length - 1)
        printf("\n");
    else
        printf(", ");
  }

  printf("Decrypted string:\n");
  decrypt(buffer, length);
  printf("%s\n", buffer);

  free(buffer);
}
